#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'
set -vx
################################################################################
##################### RESET TO INITIAL COMMIT ##################################
################################################################################
git reset --hard $(git rev-list --max-parents=  --abbrev-commit HEAD)
################################################################################
##################### INSTALL DEPENDENCIES #####################################
################################################################################
bundle install
################################################################################
##################### RUN TESTS ################################################
################################################################################
rake test
################################################################################
##################### TESTS PASS FOR INITIAL COMMIT ############################
##################### GENERATING MORE COMMITS ...   ############################
################################################################################
ruby bin/generate.rb
################################################################################
##################### GENERATED 500 COMMITS ####################################
################################################################################
git log --reverse --pretty=oneline -n9 | awk '{ print substr($NF,0,80) }' \
  | sed 's/0/ /g' | sed 's/1/#/g'
################################################################################
##################### TESTS FAIL :( ############################################
##################### FIND THE 1st BAD COMMIT ##################################
################################################################################
